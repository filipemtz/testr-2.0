<h1 class="display-2 text-center mb-4">
	{{ course.name }}
</h1>
<a class="icon-link icon-link-hover mb-2" [routerLink]="['/']">
	<i class="bi fa-solid fa-arrow-left"></i>
	Back
</a>
<br>

<!--Botão de adicionar seção-->
<button class="btn text-primary mb-2" (click)="openAddSectionModal(addSectionModal)">
	<i class="fa-regular fa-plus"></i>
	Nova Seção
</button>

<!--Seções-->
<ul *ngIf="sections.length > 0; else noSections" class="list-group list-group-flush">
	<li *ngFor="let section of sections; let i = index" class="list-group-item">
		<!--Modo de edição da seção-->
		<div *ngIf="section.isEditing; else viewSection" class="d-flex flex-wrap justify-content-start">
			<input #sectionInput class="form-control form-control-lg fw-semibold w-50 me-2" [(ngModel)]="section.name" />
			<div class="d-flex align-items-center">
				<button type="button" class="btn btn-rounded fa-check fa-solid text-success ms-1"
					(click)="confirmEditSection(section)"></button>
				<button type="button" class="btn btn-rounded fa-solid fa-xmark text-danger ms-1"
					(click)="cancelEditSection(section)"></button>
			</div>
		</div>
		<!--Modo de visualização da seção-->
		<ng-template #viewSection>
			<div class="d-flex justify-content-start align-items-center">
				<h4>{{i + 1}}. {{ section.name }}</h4>
				<button type="button" class="btn fa-solid btn-rounded fa-pencil text-primary ms-1"
					(click)="enableEditSection(section)"></button>
				<button type="button" class="btn fa-solid btn-rounded fa-trash text-danger ms-1"
					(click)="openDeleteSectionModal(section, deleteSectionModal)"></button>
			</div>
		</ng-template>
		<!--Questões da seção -->
		<ol *ngIf="section.questions?.length ?? -1 > 0; else noQuestions"
			class="list-group list-group-numbered list-group-flush ">
			<li *ngFor="let question of section.questions"  class="list-group-item list-group-item-action d-flex justify-content-start align-items-center">
				<div class="ms-1 d-flex justify-content-start align-items-center">
					<a class="m-1 link-dark link-underline link-underline-opacity-0 link-underline-opacity-75-hover"  [routerLink]="['/question', question.id]">{{ question.name }}</a>
					<button type="button" class="btn btn-sm rounded-circle text-primary ms-1" [routerLink]="['/question',question.id,'edit']">
						<i class="fa-solid fa-pencil fa-sm"></i>
					</button>
					<button type="button" class="btn btn-sm rounded-circle text-danger ms-1"
						(click)="openDeleteQuestionModal(question, deleteQuestionModal)">	
						<i class="fa-solid fa-trash fa-sm"></i>
					</button>
				</div>
			</li>
		</ol>
		<button class="btn text-primary" [routerLink]="['/section', section.id, 'question-create']">
			<i class="fa-regular fa-plus"></i>
			Nova Questão
		</button>
	</li>
</ul>

<ng-template #noSections>
	<p class="">Não existem seções disponíveis.</p>
</ng-template>

<ng-template #noQuestions>
	<p class="ms-3 mt-3">Não existem questões disponíveis.</p>
</ng-template>

<ng-template #addSectionModal let-modal>
	<div class="modal-header"><!--Cabeçalho-->
		<h4 class="modal-title" id="modal-basic-title">Criar nova seção</h4>
		<button type="button" class="btn-close" aria-label="Fechar" (click)="modal.dismiss('Cross click')" (click)="resetAddSectionForm()"></button>
	</div>
	<div class="modal-body"><!--Corpo-->
		<form [formGroup]="addSectionForm">
			<div class="mb-3">
				<label for="name">Name</label>
				<input id="name" type="text" class="form-control" formControlName="name">
				<div
					*ngIf="addSectionForm.get('name')?.invalid && (addSectionForm.get('name')?.dirty || addSectionForm.get('name')?.touched)"
					class="text-danger">
					Nome do curso é obrigatório.
				</div>
			</div>
		</form>
	</div>
	<div class="modal-footer"><!--Rodapé-->
		<button type="button" class="btn btn-danger" (click)="modal.dismiss()" (click)="resetAddSectionForm()">Cancelar</button>
		<button type="button" class="btn btn-primary" (click)="confirmAddSection()">Criar</button>
	</div>
</ng-template>

<!--Modal de deleção de Seção-->
<ng-template #deleteSectionModal let-modal>
	<div class="modal-header"><!--Cabeçalho-->
		<h4 class="modal-title" id="modal-basic-title">Deletar seção</h4>
		<button type="button" class="btn-close" aria-label="Fechar" (click)="modal.dismiss('Cross click')"></button>
	</div>
	<div class="modal-body"><!--Corpo-->
		Tem certeza que deseja deletar a seção {{ sectionToDelete?.name}}?
	</div>
	<div class="modal-footer"><!--Rodapé-->
		<button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss()">Cancelar</button>
		<button type="button" class="btn btn-danger" (click)="confirmDeleteSection()">Deletar</button>
	</div>
</ng-template>

<!--Modal de deleção de Question-->
<ng-template #deleteQuestionModal let-modal>
	<div class="modal-header"> <!--Cabeçalho-->
		<h4 class="modal-title" id="modal-basic-title">Deletar seção</h4>
		<button type="button" class="btn-close" aria-label="Fechar" (click)="modal.dismiss('Cross click')"></button>
	</div>
	<div class="modal-body"><!--Corpo-->
		Tem certeza que deseja deletar a questão?
	</div>
	<div class="modal-footer"><!--Rodapé-->
		<button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss()">Cancelar</button>
		<button type="button" class="btn btn-danger" (click)="confirmDeleteQuestion()">Deletar</button>
	</div>
</ng-template>